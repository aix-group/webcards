{% extends 'mc_and_datasheet/base.html' %}

{% block title %}
Section
{% endblock %}
{% block content %}
{% load static %}

<link rel="stylesheet" type="text/css" href="{% static 'mc_and_datasheet/css/sectiona.css' %}">
<link rel="stylesheet" href="{% static 'mc_and_datasheet/css/jquery-ui.css' %}">
<link rel="stylesheet" href="{% static 'mc_and_datasheet/css/bootstrap.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.4/font/bootstrap-icons.css">
<link href="{% static 'mc_and_datasheet/css/styles_sidebar.css' %}" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css?family=Merriweather" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script>

<!-- Include Bootstrap CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

<!-- Include Bootstrap Icons CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.4/font/bootstrap-icons.css">

<!-- Include Bootstrap JavaScript (optional) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<style>
body {
  font-family: 'Open Sans', sans-serif;
  /*background: #333333 no-repeat center center fixed;
  -webkit-background-size: cover;
  -moz-background-size: cover;
  background-size: cover;
  -o-background-size: cover;*/
 
  background-image: url({% static 'mc_and_datasheet/assets/img/section.jpg' %});
  background-repeat: no-repeat;
  background-size: cover;
}


.checkboxlabel{
  display:flex; 
  justify-content: space-between;
  text-align:justify;
}
.message{
  display:flex;
  justify-content:space-between;
}
textarea{
  width:82%;
}
.radiobuttons{
  display:flex;
}
.survey{
  font-family: 'Raleway', sans-serif;
  margin-top:40px;
}
h1{
  font-weight:400;
  font-family: 'Merriweather', serif
}
#description{
  font-family: 'Merriweather', serif
}
@media(max-width:400px){
  .checkboxlabel{
  display:block;  
}
}

#sidebar-wrapper {
position: fixed;
top: 75px; /* adjust this value as needed */
bottom: 0;
left: 0;
z-index: 1000;
overflow-y: auto;
background-color: #343a40; /* dark background color */
color: #fff; /* text color */
padding: 20px;
}

#main-content {
margin-left: 250px; /* width of the sidebar */
}

.list-group-item {
background-color: #343a40; /* set the default background color */
color: #ffffff;
}

.list-group-item:hover {
background-color: #555b60; /* set the background color when hovered */
color: #fff;
}
.active {
background-color: #337ab7;
color: #fff;
}

.drop-zone {
border: 2px dotted rgb(58, 58, 58);
height: 130px;
text-align: center;
width: 100%;
}


.drop-zone.drag-over {
border-color: #000;
}

.tooltip {
  position: relative;
  display: inline-block;
}

.tooltip-text {
  visibility: hidden;
  width: 200px;
  background-color: #000;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 5px;
  position: absolute;
  z-index: 1;
  bottom: 125%;
  left: 50%;
  margin-left: -100px;
  opacity: 0;
  transition: opacity 0.3s;
}

.tooltip:hover .tooltip-text {
  visibility: visible;
  opacity: 1;
}

.default-placeholder {
  color: #888;
}
</style>

<title>FEAT-AI</title>


<body>
  <!--Sidebar-->
  <br>
  <br>
  <br>
  <div class="border-end bg-secondary.bg-gradient text-light float-start" id="sidebar-wrapper">
    <div class="sidebar-heading border-bottom bg-dark">Sections</div>
      <div class="list-group list-group-flush bg-white active ">
        {% for section in section_list %}
        
        <a class="list-group-item-dark list-group-item list-group-item-action p-2 {% if section.id == current_section_id %}active{% endif %}" href="{% url 'mc_and_datasheet:section' section.id %}">
          {{ section.name }}
        </a>
        
        {% endfor %} 
      </div>

        <br>
        <br>
        <button class="list-group-item list-group-item-action list-group-item-dark p-2 bg-secondary" data-toggle="modal" data-target="#myModal" id="popup-btn">
          <i class="fas fa-plus-circle me-2"></i> Add Section
        </button>
        <div id="popup-container"></div>
        <br>
        <a class="list-group-item list-group-item-action list-group-item-dark p-2 bg-success" href="{% url 'mc_and_datasheet:createoutput' section.id  %}" name="createcard" class="submit-button">
          <i class="fas fa-file-export me-2"></i> Export Card to HTML
        </a>
        <br>
        <a class="list-group-item list-group-item-action list-group-item-dark p-2 bg-danger" href="{% url 'mc_and_datasheet:delete' section.id  %}?delete_section=1" name="delete_section" class="delete-button">
          <i class="fas fa-trash-alt me-2"></i> Default
        </a>
      
    </div>
    </div>
  </div>

  
 <!-- Form Area -->
 <!-- Modal -->
 <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content" style="background-color:#333333">
      <div class="modal-header">
        <h5 class="modal-title" id="myModalLabel" style="color:white">Add Section</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true" style="color:rgb(0, 0, 0)">&times;</span>
        </button>
      </div>
      <form method="POST">
        {% csrf_token %}
      <div class="modal-body">
        <div class="form-group">
          <label for="section-name" style="color:white">Enter the name of the new section:</label>
          <input type="text" class="form-control" id="section-name" name="newsectiontext">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-secondary" name="sectionsubmit" onclick="location.href=window.location.href + '?cache=' + new Date().getTime()" >Submit</button> 
      </div>
      </form>
    </div>
  </div>
</div>

 <!-- Form Area For Questions -->
  <div class="container survey" style= " z-index: 1; " >
  <form method = 'POST' id="survey-form" class=".bg-secondary.bg-gradient text-white px-10 py-10" style="margin-left: 125px; z-index: 1; ">
  {% csrf_token %}
   <div class="form-row" style= " z-index: 1; "  >
    <h1 id="title" class="text-white-50 mx-auto mt-2 mb-5 text-center" style= " z-index: 1; "  >{{section.name}} </h1>
    <p id="description" class="text-white-50 mx-auto mt-2 mb-2 text-center" style="z-index: 1; text-align: justify; margin-left: 20px; margin-right: 20px;">{{ section.section_desc }}</p>
    {% for field in section.field_set.all %}
      <div class="col" style= " z-index: 1; " >
        
        {% if field.field_question != 'What is the version date?' %}
           {% if field.field_question != 'Size of the dataset:' %}
            {% if field.field_question != 'Split Ratio:' %}
            <br>
            
            <div class="input-group">
              {{ field.field_question }}
              <div class="input-group-append">
                {% if field.field_helper %}
                <div class="tooltip-container" style="margin-left: 10px;">
                  <img src="{% static 'mc_and_datasheet/assets/question-circle-fill.svg' %}" alt="Question Icon" data-toggle="tooltip" data-placement="top" title="{{ field.field_helper|escape }}" style="background-color: transparent;">
                  <style>
                    .tooltip-inner {
                      max-width: 500px; /* Adjust the width as needed */
                    }
                  </style>
                </div>
                {% endif %}
              </div>
            </div>
                                    
            {% if field.field_question != 'Select the metrics you want to include' %}
            <div class="input-group" style="z-index: 1;">
              <textarea id="description" class="form-control bg-dark text-light" type="text" name="a{{ field.id }}" style="z-index: 1;">{{ field.get_answer }}</textarea>
              <button type="button" class="btn btn-danger">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                  <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6Z"/>
                  <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1ZM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118ZM2.5 3h11V2h-11v1Z"/>
                </svg>
              </button>
            </div>
          </div>
            {% endif %}   
          {% endif %}
        {% endif %}
      {% endif %}
      {% endfor %}
      </div>

      {% for field in section.field_set.all %}
  
      {% if field.field_question == 'What is the version date?' %}
      <br>
        
      <div class="tooltip-container" style="margin-left: 10px;">
        <label id="name-label">{{field.field_question}}</label>
        <img src="{% static 'mc_and_datasheet/assets/question-circle-fill.svg' %}" alt="Question Icon" data-toggle="tooltip" data-placement="top" title="{{ field.field_helper|escape }}" style="background-color: transparent;">
        <style>
          .tooltip-inner {
            max-width: 500px; /* Adjust the width as needed */
          }
        </style>
      </div>
        <input type="date" id="appointment-time" name="a{{field.id}}" class="form-control bg-dark text-light">
        
      {% elif field.field_question == 'Size of the dataset:' %} 
      <br>
      <label id="name-label">{{field.field_question}}</label>
        <input type="number" id="trainset" step="1" min="0" max="99999999" value="700" name="a{{field.id}}"><br>
    
      {% elif field.field_question == 'Split Ratio:' %} 
      <br>
      <label id="name-label">{{field.field_question}}</label>   
        <input type="number" id="splitratio" step="0.1" min="0.5" max="1.0" value="0.7" name="a{{field.id}}"><br>   
      <br>


      <small style="font-size: 80%;">This section will be expanded </small>
    
      {% elif section.id == 35 %}

      {% endif %}

      {% if section.id == 35 %}  
    
      <div class="container">
        <fieldset>
          <br>
          <!-- <legend>Available metrics: </legend> -->
          <div class="row mb-3">
            <div class="col-sm-4">
              <div class="input-group">
                <label for="accuracy-field">Accuracy:</label>
                <input type="number" id="accuracy-field" name="accuracy" class="form-control bg-dark text-light" step="0.01" min="0.1" max="1.0" style="width: 100px; margin-left: 18px;">
                <div class="input-group-text ms-2 bg-dark">
                  <input type="checkbox" id="accuracy" name="accuracy" value="accuracy">
                </div>
              </div>
            </div>
            <div class="col-sm-4">
              <div class="input-group">
                <label for="precision-field">Precision:</label>
                <input type="number" id="precision-field" name="precision" class="form-control bg-dark text-light" step="0.01" style="width: 100px; margin-left: 20px;">
                <div class="input-group-text ms-2 bg-dark">
                  <input type="checkbox" id="precision" name="precision" value="precision">
                </div>
              </div>
            </div>
            <div class="col-sm-4">
              <div class="input-group">
                <label for="mean-error-field">Brier Score:</label>
                <input type="number" id="mean-error-field" name="mean-error" class="form-control bg-dark text-light" step="0.01" min="0.1" max="1.0" style="width: 95px; margin-left: 10px;">
                <div class="input-group-text ms-2 bg-dark">
                  <input type="checkbox" id="mean-error" name="mean-error" value="mean-error">
                </div>
              </div>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-sm-4">
              <div class="input-group">
                <label for="recall-field">Recall:</label>
                <input type="number" id="recall-field" name="recall" class="form-control bg-dark text-light" step="0.01" min="0.1" max="1.0" style="width: 100px; margin-left: 32px;">
                <div class="input-group-text ms-2 bg-dark">
                  <input type="checkbox" id="recall" name="recall" value="recall">
                </div>
              </div>
            </div>
            <div class="col-sm-4">
              <div class="input-group">
                <label for="f1-score-field">F1 Score:</label>
                <input type="number" id="f1-score-field" name="f1-score" class="form-control bg-dark text-light" step="0.01" style="width: 100px; margin-left: 20px;">
                <div class="input-group-text ms-2 bg-dark">
                  <input type="checkbox" id="f1-score" name="f1-score" value="f1-score">
                </div>
              </div>
            </div>
            <div class="col-sm-4">
              <div class="input-group">
                <label for="specificity-field">AUC Score :</label>
                <input type="number" id="specificity-field" name="specificity" class="form-control bg-dark text-light" step="0.01" min="0.1" max="1.0" style="width: 95px; margin-left: 10px;">
                <div class="input-group-text ms-2 bg-dark">
                  <input type="checkbox" id="specificity" name="specificity" value="specificity">
                </div>
              </div>
            </div>
          </div>
        </fieldset>
        <small style="font-size: 80%;">This section will be expanded </small>
      </div>
      {% endif %}
      {% endfor %} 
  <!-- </form> -->
      <hr style="border-width: 3px;">
      {% if section.id ==  34 or section.id ==  35  %}

      {% else %}
      <form method="POST" >
        {% csrf_token %}
        <div class="form-group">
          <label id="email-label">Customize</label>
          <div class="input-group">
            
         <input id="input-text1" name="newfieldtext" type="text" class="form-control bg-secondary text-dar" aria-describedby="emailHelp" placeholder="Type the text of your new question.">
          <button type="submit" name="newfield" value= "newfield" class="btn btn-primary" onclick="saveForm()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="fas fa-plus" viewBox="0 0 16 16">
              <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6Z"/>
              <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1ZM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118ZM2.5 3h11V2h-11v1Z"/>
            </svg>
          </button>
          </div>
          <small id="emailHelp" class="form-text text-muted-lg" style="color: rgb(110, 110, 110);">You can add a new question if you have a specific desire for the model card.</small>
        </div>
        {% endif %}
        <div>
          <button type="submit" name="save" value= "save" class="btn btn-outline-secondary" style="float:right" onclick="saveForm()">Save the Answers</button>
          <button type="submit" name="clear" value = "clear" class="btn btn-outline-secondary"  style="float:right" onclick="clearTextarea()">Clear the answers</button>
        </div>
        <br>
        <br>
        <br>
        
        </form>

        <div style="text-align: left;">
          {% if section.id == 34 or section.id == 35 %}
              {% if section.id == 34 %}
              <div class="drop-zone" ondragover="event.preventDefault()" ondrop="event.preventDefault(); document.getElementById('id_file').files = event.dataTransfer.files">
                <form method="post" enctype="multipart/form-data" action="{% url 'mc_and_datasheet:upload_file' section.id %}">
                  <p>Drag and drop any image file and the dataset (.csv) file here or click to select files</p>
                  {% csrf_token %}
                  {{ form.as_p }}
                  <button class="list-group-item list-group-item-action list-group-item-dark p-3 bg-secondary" type="submit" name="upload34" value="upload">
                    <i class="fas fa-cloud-upload-alt fa-lg fa-fw me-2"></i> Upload
                  </button>
                </form>
              </div>
              {% elif section.id == 35 %}
              <div class="drop-zone" ondragover="event.preventDefault()" ondrop="event.preventDefault(); document.getElementById('id_file').files = event.dataTransfer.files">
                <p>Drag and drop the any image file and the model (.pkl) file here or click to select files</p>
                <form method="post" enctype="multipart/form-data" action="{% url 'mc_and_datasheet:upload_file' section.id %}">
                  {% csrf_token %}
                  {{ form.as_p }}
                  <button class="list-group-item list-group-item-action list-group-item-dark p-3 bg-secondary" type="submit" name="upload35" value="upload">
                    <i class="fas fa-cloud-upload-alt fa-lg fa-fw me-2"></i> Upload
                  </button>
                </form>
            </div>
            {% endif %}
          {% endif %}
          <br>
          {% if is_files %}
            <form>
              {% csrf_token %}

              <ul>
                {% for file in files %}
                {% if file.uploaded_section_id == section.id %}
                  <li>                
                        <a>{{ file.name }}</a>
                        
                        <small style="font-size: 80%;">uploaded {{ file.uploaded_at }}</small>
                  </li>
                {% endif %}
                {% endfor %}
              </ul>
             
            </form>
          {% endif %}
        </div>

  <script>
    document.querySelector('.drop-zone').ondragenter = function() {
      this.style.cursor = 'move';
    };
    document.querySelector('.drop-zone').ondragleave = function() {
      this.style.cursor = 'pointer';
    };

    
  </script>



<script>

$(document).ready(function() {
    // Get a reference to the Save Changes button
    var saveBtn = document.getElementById("save-btn");
    
    // Attach a click event listener to the Save Changes button
    saveBtn.addEventListener("click", function() {
        // Get the value of the input field
        var sectionName = document.getElementById("section-name").value;
        
        // Send the value of the input field to your Django view function
        $.ajax({
            url: "{% url 'mc_and_datasheet:section' section.id %}",
            type: "POST",
            data: {
                'section_name': sectionName,
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            },
            success: function(response) {
                // Handle the response from your view function
                console.log(response);
            },
            error: function(xhr) {
                // Handle any errors that occur during the request
                console.log(xhr.statusText);
            }
        });
    });
});


 
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  src="{% static 'mc_and_datasheet/js/jquery-ui.js' %}"

$(function () {
  $('[data-toggle="tooltip"]').tooltip();
});

function saveForm() {
    const newFieldText = document.getElementById('email').value;
    localStorage.setItem('newfieldtext', newFieldText);
}

function clearTextarea() {
  // Get the textarea element by its ID
  var textarea = document.getElementById("description");

  // Clear the textarea by setting its value to an empty string
  textarea.value = "";
}
  
  window.onload = function() {
    const form = document.getElementById('section-form');
    for (let i = 0; i < form.elements.length; i++) {
      const element = form.elements[i];
      if (element.type !== 'button') {
        const value = localStorage.getItem(element.name);
        if (value) {
          element.value = value;
        }
      }
    }
  };
   
  
  // Get the current section ID from the URL
  var currentSectionId = '{{ section_id }}';

  // Find the link that matches the current section ID and add the 'active' class to it
  var links = document.querySelectorAll('.navigation-menu a');
  for (var i = 0; i < links.length; i++) {
    var link = links[i];
    if (link.getAttribute('data-section') == currentSectionId) {
      link.classList.add('active');
      break;
    }
  }
  // Add click event listener to delete buttons
  const deleteBtns = document.querySelectorAll('.btn-danger');
deleteBtns.forEach((btn) => {
  btn.addEventListener('click', () => {
    const grandparent = btn.parentNode.parentNode;
    grandparent.parentNode.removeChild(grandparent);
  });
});

// get the date picker input element
const datePicker = document.getElementById('appointment-time');

// get the span element that will display the selected date
const selectedDate = document.getElementById('selected-date');

// add an event listener to the input element that will update the selected date when a new date is selected
datePicker.addEventListener('input', () => {
  selectedDate.textContent = datePicker.value;
});

</script>

<!-- Footer-->
<!--<footer class="footer bg-black small text-center text-white-50"><div class="container px-4 px-lg-5">Copyright &copy; Feat-AI 2023</div></footer>-->
<!-- Bootstrap core JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Core theme JS-->
<script src="{% static 'mc_and_datasheet/js/scripts.js' %}"></script>
<script src="{% static 'mc_and_datasheet/js/scripts_sidebar.js' %}"></script>
<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
<!-- * *                               SB Forms JS                               * *-->
<!-- * * Activate your form at https://startbootstrap.com/solution/contact-forms * *-->
<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
<script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>


{% endblock %}